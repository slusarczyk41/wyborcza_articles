06/02/2019 08:02:27 AM INFO: Reading notebook old_articles.ipynb
06/02/2019 08:02:28 AM INFO: Running cell:
from selenium import webdriver
import pandas as pd
from scrap_article_current_tab import scrap_article

from datetime import datetime as dt
from datetime import timedelta as td
from os import makedirs
from os.path import exists
from time import sleep
from json import loads

06/02/2019 08:02:29 AM INFO: Cell returned
06/02/2019 08:02:29 AM INFO: Running cell:
now = dt.now()
year = now.year
month = now.month
day = now.day
ts = str(int(round(now.timestamp())))

06/02/2019 08:02:29 AM INFO: Cell returned
06/02/2019 08:02:29 AM INFO: Running cell:
options = webdriver.ChromeOptions()
options.add_argument('--headless')
chrome = webdriver.Chrome(options=options)

06/02/2019 08:02:30 AM INFO: Cell returned
06/02/2019 08:02:30 AM INFO: Running cell:
#chrome = webdriver.Chrome()

06/02/2019 08:02:30 AM INFO: Cell returned
06/02/2019 08:02:30 AM INFO: Running cell:
chrome.get(url = 'http://wyborcza.pl/0,75248.html?str=100_23719317')

06/02/2019 08:02:36 AM INFO: Cell returned
06/02/2019 08:02:36 AM INFO: Running cell:
sleep(10)

06/02/2019 08:02:46 AM INFO: Cell returned
06/02/2019 08:02:46 AM INFO: Running cell:
# try to click rodo (first click opens sometimes an ad)
for i in range(3):
    try:
        sleep(3)
        chrome.find_element_by_xpath('//*[@id="rodoNotificationWrapper"]/div[1]/div/p[2]')\
            .click()
    except:
        pass

06/02/2019 08:02:55 AM INFO: Cell returned
06/02/2019 08:02:55 AM INFO: Running cell:
# close new window
try:
    chrome.switch_to.window(chrome.window_handles[1])
    chrome.close()
except:
    pass

06/02/2019 08:02:55 AM INFO: Cell returned
06/02/2019 08:02:55 AM INFO: Running cell:
chrome.switch_to.window(chrome.window_handles[0])

06/02/2019 08:02:55 AM INFO: Cell returned
06/02/2019 08:02:55 AM INFO: Running cell:
urls = []
for i in range(100, 1000):
    chrome.get(url = 'http://wyborcza.pl/0,75248.html?str='+str(i)+'_23719317')
    for entry in chrome\
        .find_element_by_xpath('//*[@id="pagetype_index"]/section[5]/div/main/div/div[2]/div/div[2]/ul')\
        .find_elements_by_class_name('entry'):
        
        url = entry.find_element_by_tag_name('h3')\
                .find_element_by_tag_name('a')\
                .get_attribute('href')
        #scrap_article(chrome, url, first_time)
        urls.append(url)
    break
    

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
len(urls)

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
import pandas as pd

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
# df = pd.DataFrame(urls, columns = ['urls'])

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
# df.to_csv('old_urls.csv')

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
df = pd.read_csv('old_urls.csv')

06/02/2019 08:02:58 AM INFO: Cell returned
06/02/2019 08:02:58 AM INFO: Running cell:
for url in df['urls'].values:
    a = scrap_article(chrome, url, True)
    with open('data/comments/'+a['url'].split('/')[-1].split(',')[2], 'w') as f:
        f.write(str({'row': {
           'comments': a,
           'timestamp': dt.timestamp(dt.now())
           }
        }))
    print(a['url'].split('/')[-1].split(',')[2])
    continue

06/02/2019 08:03:22 AM INFO: Cell raised uncaught exception: 
[0;31m---------------------------------------------------------------------------[0m
[0;31mNoSuchElementException[0m                    Traceback (most recent call last)
[0;32m<ipython-input-16-0f40c74c3c83>[0m in [0;36m<module>[0;34m[0m
[1;32m      1[0m [0;32mfor[0m [0murl[0m [0;32min[0m [0mdf[0m[0;34m[[0m[0;34m'urls'[0m[0;34m][0m[0;34m.[0m[0mvalues[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m----> 2[0;31m     [0ma[0m [0;34m=[0m [0mscrap_article[0m[0;34m([0m[0mchrome[0m[0;34m,[0m [0murl[0m[0;34m,[0m [0;32mTrue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m      3[0m     [0;32mwith[0m [0mopen[0m[0;34m([0m[0;34m'data/comments/'[0m[0;34m+[0m[0ma[0m[0;34m[[0m[0;34m'url'[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m'/'[0m[0;34m)[0m[0;34m[[0m[0;34m-[0m[0;36m1[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m','[0m[0;34m)[0m[0;34m[[0m[0;36m2[0m[0;34m][0m[0;34m,[0m [0;34m'w'[0m[0;34m)[0m [0;32mas[0m [0mf[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m      4[0m         f.write(str({'row': {
[1;32m      5[0m            [0;34m'comments'[0m[0;34m:[0m [0ma[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/wyborcza_articles/scrap_article_current_tab.py[0m in [0;36mscrap_article[0;34m(chrome, url, first_time)[0m
[1;32m     26[0m [0;34m[0m[0m
[1;32m     27[0m         [0marticle[0m[0;34m[[0m[0;34m'pub_date'[0m[0;34m][0m [0;34m=[0m [0mchrome[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 28[0;31m             [0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//*[@id="art-datetime"]'[0m[0;34m)[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     29[0m             [0;34m.[0m[0mtext[0m[0;34m[0m[0;34m[0m[0m
[1;32m     30[0m         [0marticle[0m[0;34m[[0m[0;34m'author'[0m[0;34m][0m [0;34m=[0m [0mchrome[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element_by_xpath[0;34m(self, xpath)[0m
[1;32m    392[0m             [0melement[0m [0;34m=[0m [0mdriver[0m[0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//div/td[1]'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    393[0m         """
[0;32m--> 394[0;31m         [0;32mreturn[0m [0mself[0m[0;34m.[0m[0mfind_element[0m[0;34m([0m[0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mXPATH[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0mxpath[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    395[0m [0;34m[0m[0m
[1;32m    396[0m     [0;32mdef[0m [0mfind_elements_by_xpath[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mxpath[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element[0;34m(self, by, value)[0m
[1;32m    976[0m         return self.execute(Command.FIND_ELEMENT, {
[1;32m    977[0m             [0;34m'using'[0m[0;34m:[0m [0mby[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 978[0;31m             'value': value})['value']
[0m[1;32m    979[0m [0;34m[0m[0m
[1;32m    980[0m     [0;32mdef[0m [0mfind_elements[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mID[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0;32mNone[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mexecute[0;34m(self, driver_command, params)[0m
[1;32m    319[0m         [0mresponse[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0mcommand_executor[0m[0;34m.[0m[0mexecute[0m[0;34m([0m[0mdriver_command[0m[0;34m,[0m [0mparams[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    320[0m         [0;32mif[0m [0mresponse[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 321[0;31m             [0mself[0m[0;34m.[0m[0merror_handler[0m[0;34m.[0m[0mcheck_response[0m[0;34m([0m[0mresponse[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    322[0m             response['value'] = self._unwrap_value(
[1;32m    323[0m                 response.get('value', None))

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/errorhandler.py[0m in [0;36mcheck_response[0;34m(self, response)[0m
[1;32m    240[0m                 [0malert_text[0m [0;34m=[0m [0mvalue[0m[0;34m[[0m[0;34m'alert'[0m[0;34m][0m[0;34m.[0m[0mget[0m[0;34m([0m[0;34m'text'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    241[0m             [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m,[0m [0malert_text[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 242[0;31m         [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    243[0m [0;34m[0m[0m
[1;32m    244[0m     [0;32mdef[0m [0m_value_or_default[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mobj[0m[0;34m,[0m [0mkey[0m[0;34m,[0m [0mdefault[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;31mNoSuchElementException[0m: Message: no such element: Unable to locate element: {"method":"xpath","selector":"//*[@id="art-datetime"]"}
  (Session info: headless chrome=74.0.3729.157)
  (Driver info: chromedriver=74.0.3729.6 (255758eccf3d244491b8a1317aa76e1ce10d57e9-refs/branch-heads/3729@{#29}),platform=Linux 4.9.0-8-amd64 x86_64)

06/02/2019 08:03:22 AM INFO: Shutdown kernel
06/02/2019 08:03:23 AM WARNING: Exiting with nonzero exit status
06/02/2019 08:04:51 AM INFO: Reading notebook old_articles.ipynb
06/02/2019 08:04:52 AM INFO: Running cell:
from selenium import webdriver
import pandas as pd
from scrap_article_current_tab import scrap_article

from datetime import datetime as dt
from datetime import timedelta as td
from os import makedirs
from os.path import exists
from time import sleep
from json import loads

06/02/2019 08:04:53 AM INFO: Cell returned
06/02/2019 08:04:53 AM INFO: Running cell:
now = dt.now()
year = now.year
month = now.month
day = now.day
ts = str(int(round(now.timestamp())))

06/02/2019 08:04:53 AM INFO: Cell returned
06/02/2019 08:04:53 AM INFO: Running cell:
options = webdriver.ChromeOptions()
options.add_argument('--headless')
chrome = webdriver.Chrome(options=options)

06/02/2019 08:04:54 AM INFO: Cell returned
06/02/2019 08:04:54 AM INFO: Running cell:
#chrome = webdriver.Chrome()

06/02/2019 08:04:54 AM INFO: Cell returned
06/02/2019 08:04:54 AM INFO: Running cell:
chrome.get(url = 'http://wyborcza.pl/0,75248.html?str=100_23719317')

06/02/2019 08:05:00 AM INFO: Cell returned
06/02/2019 08:05:00 AM INFO: Running cell:
sleep(10)

06/02/2019 08:05:10 AM INFO: Cell returned
06/02/2019 08:05:10 AM INFO: Running cell:
# try to click rodo (first click opens sometimes an ad)
for i in range(3):
    try:
        sleep(3)
        chrome.find_element_by_xpath('//*[@id="rodoNotificationWrapper"]/div[1]/div/p[2]')\
            .click()
    except:
        pass

06/02/2019 08:05:19 AM INFO: Cell returned
06/02/2019 08:05:19 AM INFO: Running cell:
# close new window
try:
    chrome.switch_to.window(chrome.window_handles[1])
    chrome.close()
except:
    pass

06/02/2019 08:05:19 AM INFO: Cell returned
06/02/2019 08:05:19 AM INFO: Running cell:
chrome.switch_to.window(chrome.window_handles[0])

06/02/2019 08:05:19 AM INFO: Cell returned
06/02/2019 08:05:19 AM INFO: Running cell:
urls = []
for i in range(100, 1000):
    chrome.get(url = 'http://wyborcza.pl/0,75248.html?str='+str(i)+'_23719317')
    for entry in chrome\
        .find_element_by_xpath('//*[@id="pagetype_index"]/section[5]/div/main/div/div[2]/div/div[2]/ul')\
        .find_elements_by_class_name('entry'):
        
        url = entry.find_element_by_tag_name('h3')\
                .find_element_by_tag_name('a')\
                .get_attribute('href')
        #scrap_article(chrome, url, first_time)
        urls.append(url)
    break
    

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
len(urls)

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
import pandas as pd

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
# df = pd.DataFrame(urls, columns = ['urls'])

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
# df.to_csv('old_urls.csv')

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
df = pd.read_csv('old_urls.csv')

06/02/2019 08:05:24 AM INFO: Cell returned
06/02/2019 08:05:24 AM INFO: Running cell:
for url in df['urls'].values:
    print(url)
    a = scrap_article(chrome, url, True)
    with open('data/comments/'+a['url'].split('/')[-1].split(',')[2], 'w') as f:
        f.write(str({'row': {
           'comments': a,
           'timestamp': dt.timestamp(dt.now())
           }
        }))
    print(a['url'].split('/')[-1].split(',')[2])
    continue

06/02/2019 08:05:47 AM INFO: Cell raised uncaught exception: 
[0;31m---------------------------------------------------------------------------[0m
[0;31mNoSuchElementException[0m                    Traceback (most recent call last)
[0;32m<ipython-input-16-5e16e7efbca7>[0m in [0;36m<module>[0;34m[0m
[1;32m      1[0m [0;32mfor[0m [0murl[0m [0;32min[0m [0mdf[0m[0;34m[[0m[0;34m'urls'[0m[0;34m][0m[0;34m.[0m[0mvalues[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m      2[0m     [0mprint[0m[0;34m([0m[0murl[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m----> 3[0;31m     [0ma[0m [0;34m=[0m [0mscrap_article[0m[0;34m([0m[0mchrome[0m[0;34m,[0m [0murl[0m[0;34m,[0m [0;32mTrue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m      4[0m     [0;32mwith[0m [0mopen[0m[0;34m([0m[0;34m'data/comments/'[0m[0;34m+[0m[0ma[0m[0;34m[[0m[0;34m'url'[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m'/'[0m[0;34m)[0m[0;34m[[0m[0;34m-[0m[0;36m1[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m','[0m[0;34m)[0m[0;34m[[0m[0;36m2[0m[0;34m][0m[0;34m,[0m [0;34m'w'[0m[0;34m)[0m [0;32mas[0m [0mf[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m      5[0m         f.write(str({'row': {

[0;32m~/wyborcza_articles/scrap_article_current_tab.py[0m in [0;36mscrap_article[0;34m(chrome, url, first_time)[0m
[1;32m     26[0m [0;34m[0m[0m
[1;32m     27[0m         [0marticle[0m[0;34m[[0m[0;34m'pub_date'[0m[0;34m][0m [0;34m=[0m [0mchrome[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 28[0;31m             [0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//*[@id="art-datetime"]'[0m[0;34m)[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     29[0m             [0;34m.[0m[0mtext[0m[0;34m[0m[0;34m[0m[0m
[1;32m     30[0m         [0marticle[0m[0;34m[[0m[0;34m'author'[0m[0;34m][0m [0;34m=[0m [0mchrome[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element_by_xpath[0;34m(self, xpath)[0m
[1;32m    392[0m             [0melement[0m [0;34m=[0m [0mdriver[0m[0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//div/td[1]'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    393[0m         """
[0;32m--> 394[0;31m         [0;32mreturn[0m [0mself[0m[0;34m.[0m[0mfind_element[0m[0;34m([0m[0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mXPATH[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0mxpath[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    395[0m [0;34m[0m[0m
[1;32m    396[0m     [0;32mdef[0m [0mfind_elements_by_xpath[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mxpath[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element[0;34m(self, by, value)[0m
[1;32m    976[0m         return self.execute(Command.FIND_ELEMENT, {
[1;32m    977[0m             [0;34m'using'[0m[0;34m:[0m [0mby[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 978[0;31m             'value': value})['value']
[0m[1;32m    979[0m [0;34m[0m[0m
[1;32m    980[0m     [0;32mdef[0m [0mfind_elements[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mID[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0;32mNone[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mexecute[0;34m(self, driver_command, params)[0m
[1;32m    319[0m         [0mresponse[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0mcommand_executor[0m[0;34m.[0m[0mexecute[0m[0;34m([0m[0mdriver_command[0m[0;34m,[0m [0mparams[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    320[0m         [0;32mif[0m [0mresponse[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 321[0;31m             [0mself[0m[0;34m.[0m[0merror_handler[0m[0;34m.[0m[0mcheck_response[0m[0;34m([0m[0mresponse[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    322[0m             response['value'] = self._unwrap_value(
[1;32m    323[0m                 response.get('value', None))

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/errorhandler.py[0m in [0;36mcheck_response[0;34m(self, response)[0m
[1;32m    240[0m                 [0malert_text[0m [0;34m=[0m [0mvalue[0m[0;34m[[0m[0;34m'alert'[0m[0;34m][0m[0;34m.[0m[0mget[0m[0;34m([0m[0;34m'text'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    241[0m             [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m,[0m [0malert_text[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 242[0;31m         [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    243[0m [0;34m[0m[0m
[1;32m    244[0m     [0;32mdef[0m [0m_value_or_default[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mobj[0m[0;34m,[0m [0mkey[0m[0;34m,[0m [0mdefault[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;31mNoSuchElementException[0m: Message: no such element: Unable to locate element: {"method":"xpath","selector":"//*[@id="art-datetime"]"}
  (Session info: headless chrome=74.0.3729.157)
  (Driver info: chromedriver=74.0.3729.6 (255758eccf3d244491b8a1317aa76e1ce10d57e9-refs/branch-heads/3729@{#29}),platform=Linux 4.9.0-8-amd64 x86_64)

06/02/2019 08:05:47 AM INFO: Shutdown kernel
06/02/2019 08:05:48 AM WARNING: Exiting with nonzero exit status
06/02/2019 08:20:57 AM INFO: Reading notebook old_articles.ipynb
06/02/2019 08:20:59 AM INFO: Running cell:
from selenium import webdriver
import pandas as pd
from scrap_article_current_tab import scrap_article

from datetime import datetime as dt
from datetime import timedelta as td
from os import makedirs
from os.path import exists
from time import sleep
from json import loads

06/02/2019 08:20:59 AM INFO: Cell returned
06/02/2019 08:20:59 AM INFO: Running cell:
now = dt.now()
year = now.year
month = now.month
day = now.day
ts = str(int(round(now.timestamp())))

06/02/2019 08:20:59 AM INFO: Cell returned
06/02/2019 08:20:59 AM INFO: Running cell:
options = webdriver.ChromeOptions()
options.add_argument('--headless')
chrome = webdriver.Chrome(options=options)

06/02/2019 08:21:00 AM INFO: Cell returned
06/02/2019 08:21:00 AM INFO: Running cell:
#chrome = webdriver.Chrome()

06/02/2019 08:21:00 AM INFO: Cell returned
06/02/2019 08:21:00 AM INFO: Running cell:
chrome.get(url = 'http://wyborcza.pl/0,75248.html?str=100_23719317')

06/02/2019 08:21:07 AM INFO: Cell returned
06/02/2019 08:21:07 AM INFO: Running cell:
sleep(10)

06/02/2019 08:21:17 AM INFO: Cell returned
06/02/2019 08:21:17 AM INFO: Running cell:
# try to click rodo (first click opens sometimes an ad)
for i in range(3):
    try:
        sleep(3)
        chrome.find_element_by_xpath('//*[@id="rodoNotificationWrapper"]/div[1]/div/p[2]')\
            .click()
    except:
        pass

06/02/2019 08:21:27 AM INFO: Cell returned
06/02/2019 08:21:27 AM INFO: Running cell:
# close new window
try:
    chrome.switch_to.window(chrome.window_handles[1])
    chrome.close()
except:
    pass

06/02/2019 08:21:27 AM INFO: Cell returned
06/02/2019 08:21:27 AM INFO: Running cell:
chrome.switch_to.window(chrome.window_handles[0])

06/02/2019 08:21:27 AM INFO: Cell returned
06/02/2019 08:21:27 AM INFO: Running cell:
urls = []
for i in range(100, 1000):
    chrome.get(url = 'http://wyborcza.pl/0,75248.html?str='+str(i)+'_23719317')
    for entry in chrome\
        .find_element_by_xpath('//*[@id="pagetype_index"]/section[5]/div/main/div/div[2]/div/div[2]/ul')\
        .find_elements_by_class_name('entry'):
        
        url = entry.find_element_by_tag_name('h3')\
                .find_element_by_tag_name('a')\
                .get_attribute('href')
        #scrap_article(chrome, url, first_time)
        urls.append(url)
    break
    

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
len(urls)

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
import pandas as pd

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
# df = pd.DataFrame(urls, columns = ['urls'])

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
# df.to_csv('old_urls.csv')

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
df = pd.read_csv('old_urls.csv')

06/02/2019 08:21:30 AM INFO: Cell returned
06/02/2019 08:21:30 AM INFO: Running cell:
for url in df['urls'].values:
    print(url)
    a = scrap_article(chrome, url, True)
    with open('data/comments/'+a['url'].split('/')[-1].split(',')[2], 'w') as f:
        f.write(str({'row': {
           'comments': a,
           'timestamp': dt.timestamp(dt.now())
           }
        }))
    print(a['url'].split('/')[-1].split(',')[2])
    continue

06/02/2019 08:27:16 AM INFO: Cell raised uncaught exception: 
[0;31m---------------------------------------------------------------------------[0m
[0;31mNoSuchElementException[0m                    Traceback (most recent call last)
[0;32m<ipython-input-16-5e16e7efbca7>[0m in [0;36m<module>[0;34m[0m
[1;32m      1[0m [0;32mfor[0m [0murl[0m [0;32min[0m [0mdf[0m[0;34m[[0m[0;34m'urls'[0m[0;34m][0m[0;34m.[0m[0mvalues[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m      2[0m     [0mprint[0m[0;34m([0m[0murl[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m----> 3[0;31m     [0ma[0m [0;34m=[0m [0mscrap_article[0m[0;34m([0m[0mchrome[0m[0;34m,[0m [0murl[0m[0;34m,[0m [0;32mTrue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m      4[0m     [0;32mwith[0m [0mopen[0m[0;34m([0m[0;34m'data/comments/'[0m[0;34m+[0m[0ma[0m[0;34m[[0m[0;34m'url'[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m'/'[0m[0;34m)[0m[0;34m[[0m[0;34m-[0m[0;36m1[0m[0;34m][0m[0;34m.[0m[0msplit[0m[0;34m([0m[0;34m','[0m[0;34m)[0m[0;34m[[0m[0;36m2[0m[0;34m][0m[0;34m,[0m [0;34m'w'[0m[0;34m)[0m [0;32mas[0m [0mf[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m      5[0m         f.write(str({'row': {

[0;32m~/wyborcza_articles/scrap_article_current_tab.py[0m in [0;36mscrap_article[0;34m(chrome, url, first_time)[0m
[1;32m     29[0m             [0;34m.[0m[0mtext[0m[0;34m[0m[0;34m[0m[0m
[1;32m     30[0m         [0marticle[0m[0;34m[[0m[0;34m'author'[0m[0;34m][0m [0;34m=[0m [0mchrome[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 31[0;31m              [0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//*[@id="art-header"]/div[3]/div[1]/span'[0m[0;34m)[0m[0;31m [0m[0;31m\[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     32[0m              [0;34m.[0m[0mtext[0m[0;34m[0m[0;34m[0m[0m
[1;32m     33[0m [0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element_by_xpath[0;34m(self, xpath)[0m
[1;32m    392[0m             [0melement[0m [0;34m=[0m [0mdriver[0m[0;34m.[0m[0mfind_element_by_xpath[0m[0;34m([0m[0;34m'//div/td[1]'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    393[0m         """
[0;32m--> 394[0;31m         [0;32mreturn[0m [0mself[0m[0;34m.[0m[0mfind_element[0m[0;34m([0m[0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mXPATH[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0mxpath[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    395[0m [0;34m[0m[0m
[1;32m    396[0m     [0;32mdef[0m [0mfind_elements_by_xpath[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mxpath[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mfind_element[0;34m(self, by, value)[0m
[1;32m    976[0m         return self.execute(Command.FIND_ELEMENT, {
[1;32m    977[0m             [0;34m'using'[0m[0;34m:[0m [0mby[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 978[0;31m             'value': value})['value']
[0m[1;32m    979[0m [0;34m[0m[0m
[1;32m    980[0m     [0;32mdef[0m [0mfind_elements[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mby[0m[0;34m=[0m[0mBy[0m[0;34m.[0m[0mID[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0;32mNone[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/webdriver.py[0m in [0;36mexecute[0;34m(self, driver_command, params)[0m
[1;32m    319[0m         [0mresponse[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0mcommand_executor[0m[0;34m.[0m[0mexecute[0m[0;34m([0m[0mdriver_command[0m[0;34m,[0m [0mparams[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    320[0m         [0;32mif[0m [0mresponse[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 321[0;31m             [0mself[0m[0;34m.[0m[0merror_handler[0m[0;34m.[0m[0mcheck_response[0m[0;34m([0m[0mresponse[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    322[0m             response['value'] = self._unwrap_value(
[1;32m    323[0m                 response.get('value', None))

[0;32m~/anaconda3/lib/python3.7/site-packages/selenium/webdriver/remote/errorhandler.py[0m in [0;36mcheck_response[0;34m(self, response)[0m
[1;32m    240[0m                 [0malert_text[0m [0;34m=[0m [0mvalue[0m[0;34m[[0m[0;34m'alert'[0m[0;34m][0m[0;34m.[0m[0mget[0m[0;34m([0m[0;34m'text'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    241[0m             [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m,[0m [0malert_text[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 242[0;31m         [0;32mraise[0m [0mexception_class[0m[0;34m([0m[0mmessage[0m[0;34m,[0m [0mscreen[0m[0;34m,[0m [0mstacktrace[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    243[0m [0;34m[0m[0m
[1;32m    244[0m     [0;32mdef[0m [0m_value_or_default[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mobj[0m[0;34m,[0m [0mkey[0m[0;34m,[0m [0mdefault[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;31mNoSuchElementException[0m: Message: no such element: Unable to locate element: {"method":"xpath","selector":"//*[@id="art-header"]/div[3]/div[1]/span"}
  (Session info: headless chrome=74.0.3729.157)
  (Driver info: chromedriver=74.0.3729.6 (255758eccf3d244491b8a1317aa76e1ce10d57e9-refs/branch-heads/3729@{#29}),platform=Linux 4.9.0-8-amd64 x86_64)

06/02/2019 08:27:16 AM INFO: Shutdown kernel
06/02/2019 08:27:17 AM WARNING: Exiting with nonzero exit status
